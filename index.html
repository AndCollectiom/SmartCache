<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SmartCache for Retrofit2</title>
    
    <link rel="stylesheet" href="res/flasky.css" type="text/css" />
    <link rel="top" title="SmartCache for Retrofit2 - Introduction & docs" href="#" />
    <link rel="next" title="Introduction" href="user/intro/" />
  
    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:100,200,300,400,600,700&amp;subset=latin,latin-ext" type="text/css" rel="stylesheet" />

  </head>
  <body role="document">
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
            <div class="section" id="requests-http-for-humans">
                <h1>SmartCache for Retrofit 2</h1>
                <h2 id="introduction">Introduction</h2>
<p>SmartCache is a library that offers an additional caching layer for the popular HTTP type-safe client - <a href="http://square.github.io/retrofit/">Retrofit 2</a>.</p>
<p>Some of the features provided are:</p>
<ul>
<li>Memory-based caching</li>
<li>Instant cache responses (cache is read before the network request is started)</li>
<li>Adapter/extensibility support</li>
</ul>
<p><span class="yellow"><strong>NOTE:</strong> SmartCache is an additional layer of caching, so you can (and should) keep the standard HTTP caching offered by Retrofit.</span></p>
<h2 id="download-and-use">Download and use</h2>
<p>1. To integrate it in your app, enable the <code class="java">SmartCallFactory</code>:</p>
<pre><code class="java">SmartCallFactory smartFactory = new SmartCallFactory(BasicCaching.fromCtx(this));
Retrofit retrofit = new Retrofit.Builder()
    .baseUrl("http://myapi.com")
    .addCallAdapterFactory(smartFactory) // add this!
    .build();
</code></pre>
<p>2. Replace all your <code class="java">Call&lt;T&gt;</code>s with <code class="java">SmartCall&lt;T&gt;</code>s:</p>
<pre><code class="java">public interface GitHubService {
  @GET("/users/{user}/repos")
  SmartCall&lt;List&lt;Repo&gt;&gt; listRepos(@Path("user") String user);
}
</code></pre>
<h2 id="how-it-works">How it works</h2>
<p>SmartCache isn't constrained by the 1 response per request limit that Retrofit imposes. This means that your asynchronous callbacks will first get called when cache is loaded, and then when the network response is ready.</p>
<p><img alt="SmartCache for Retrofit2" src="res/how_it_works.png" /></p>
<h2 id="documentation">Documentation</h2>
<h4 id="smartcallfactory">SmartCallFactory</h4>
<pre><code class="java">public SmartCallFactory(CachingSystem cachingSystem);
</code></pre>
<p>Instantiates the factory that handles <code class="java">SmartCall</code>s, where <code class="java">cachingSystem</code> is an instance that implements a caching system. This factory should be added to Retrofit using <code class="java">addCallAdapterFactory()</code>:</p>
<pre><code class="java">Retrofit retrofit = new Retrofit.Builder().addCallAdapterFactory(new MyCachingSystem()).build();
</code></pre>
<h4 id="smartcall">SmartCall</h4>
<p>This interface specifies the call instance that you will get when using your API services.  Methods provided:</p>
<ul>
<li><code class="java">void enqueue(Callback&lt;T&gt;)</code> - enqueues a request. <code class="java">callback</code> will be called with cached or networked response</li>
<li><code class="java">SmartCall&lt;T&gt; clone()</code> - creates an identical call. Useful when you have query params and you don't want to initialize everything again</li>
<li><code class="java">Response&lt;T&gt; execute()</code> - executes a blocking call (!). <strong>Note:</strong> no smart caching will be done.</li>
<li><code class="java">void cancel()</code> - cancels the encapsulated request if it hasn't started</li>
</ul>
<p>You <strong>must</strong> use <code class="java">SmartCall</code>s when defining your services if you want smart caching:</p>
<pre><code class="java">interface MyAPI{
    @GET("/me")
    SmartCall&lt;User&gt; getMe();
}
</code></pre>
<h4 id="basiccaching">BasicCaching</h4>
<p>Basic implementation of a caching system that uses memory and disk LRU space to save responses. Caches GET requests only by default.</p>
<p>Constructing it from a context loads optimal values:</p>
<pre><code class="java">CachingSystem system = BasicCaching.fromCtx(this); // loads optimal values
</code></pre>
<p>If you want to set your own values use the constructor, or override methods:</p>
<pre><code class="java">CachingSystem system = new BasicCaching(
    new File(getCacheDir(), "myDir"), // caching dir
    1024 * 1024, // max disk size
    50 // max memory entries
);
</code></pre>
            </div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#"><img class="logo" src="res/logo.png" title="Rezzy the Requests Sea Turtle"/></a></p>

            <p>
            <iframe src="http://ghbtns.com/github-btn.html?user=dimitrovskif&repo=SmartCache&type=watch&count=true&size=large"
            allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
            </p>

            <p>
              Smarter caching layer on top of Retrofit 2.
            </p>

            <h3>Table of contents</h3>
            <div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#download-and-use">Download and use</a></li>
<li><a href="#how-it-works">How it works</a></li>
<li><a href="#documentation">Documentation</a><ul>
<li><a href="#smartcallfactory">SmartCallFactory</a></li>
<li><a href="#smartcall">SmartCall</a></li>
<li><a href="#basiccaching">BasicCaching</a></li>
</ul>
</li>
</ul>
</div>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy; Copyright 2015 Filip Dimitrovski
    </div>
    <a href="https://github.com/dimitrovskif/SmartCache"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/121cd7cbdc3e4855075ea8b558508b91ac463ac2/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_green_007200.png"></a>
  </body>
</html>